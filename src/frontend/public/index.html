<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EODT4Crises - Interactive Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="map"></div>
    <div id="loader">Processing...</div>

    <div class="title-overlay">EODT4Crises Road Identification</div>

    <div class="controls-container">
        <div class="layer-control">
            <label class="switch"><input type="checkbox" id="baseMapToggle" checked><span class="slider round"></span></label>
            <span class="toggle-label">Base Map</span>
        </div>
        <div class="layer-control">
            <label class="switch"><input type="checkbox" id="roadToggle" checked><span class="slider round"></span></label>
            <span class="toggle-label">OSM Roads</span>
        </div>

        <div class="road-filters section-divider">
            <div class="collapsible-header"><strong>OSM Road Types</strong><span class="arrow">â–¼</span></div>
            <div class="collapsible-content">
                <label><input type="checkbox" class="road-type-filter" value="motorway" checked> Motorway</label>
                <label><input type="checkbox" class="road-type-filter" value="motorway_link" checked> Motorway Link</label>
                <label><input type="checkbox" class="road-type-filter" value="trunk" checked> Trunk</label>
                <label><input type="checkbox" class="road-type-filter" value="primary" checked> Primary</label>
                <label><input type="checkbox" class="road-type-filter" value="secondary" checked> Secondary</label>
                <label><input type="checkbox" class="road-type-filter" value="tertiary" checked> Tertiary</label>
                <label><input type="checkbox" class="road-type-filter" value="residential" checked> Residential</label>
                <label><input type="checkbox" class="road-type-filter" value="unclassified" checked> Unclassified</label>
                <button id="updateRoadsBtn" class="action-button">Update Roads</button>
            </div>
        </div>
        
        <div class="analysis-workflow section-divider">
            <strong>Analysis Workflow:</strong>
            
            <div class="workflow-stage">
                <div class="date-control-item">
                    <label for="startDate">Start Date:</label>
                    <input type="date" id="startDate" style="width: 100%;">
                </div>
                <div class="date-control-item">
                    <label for="endDate">End Date:</label>
                    <input type="date" id="endDate" style="width: 100%;">
                </div>
                <button id="generateImageBtn" class="action-button" disabled>1. Generate Satellite Image</button>
                <div id="satelliteControls" style="display: none; margin-top: 10px;">
                    <p id="imageDateDisplay" style="font-size: 0.9em; margin-bottom: 10px;"></p>
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="toggleSat" checked><span class="slider round"></span></label>
                        <span class="toggle-label">Satellite Image</span>
                    </div>
                    <div class="layer-control">
                        <label class="toggle-label">Opacity:</label>
                        <input type="range" id="opacitySlider" min="0" max="1" step="0.05" value="0.8" style="width: 100px; margin-left: 8px;">
                    </div>
                </div>
            </div>

            <div class="workflow-stage">
                <button id="generateGTMaskBtn" class="action-button" disabled>2. Generate GT Mask</button>
                <div id="gtMaskControls" style="display: none; margin-top: 10px;">
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="toggleGtMask" checked><span class="slider round"></span></label>
                        <span class="toggle-label">GT Mask</span>
                    </div>
                    <div class="layer-control">
                        <label class="toggle-label">Opacity:</label>
                        <input type="range" id="gtMaskOpacitySlider" min="0" max="1" step="0.05" value="0.7" style="width: 100px; margin-left: 8px;">
                    </div>
                </div>
            </div>

            <div class="workflow-stage">
                <button id="runDetectionBtn" class="action-button" disabled>3. Run Detection</button>
                <div id="detectionControls" style="display: none; margin-top: 10px;">
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="togglePredMask" checked><span class="slider round"></span></label>
                        <span class="toggle-label">Pred. Mask</span>
                    </div>
                     <div class="layer-control">
                        <label class="toggle-label">Opacity:</label>
                        <input type="range" id="predMaskOpacitySlider" min="0" max="1" step="0.05" value="0.7" style="width: 100px; margin-left: 8px;">
                    </div>
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="togglePredGraph" checked><span class="slider round"></span></label>
                        <span class="toggle-label">Pred. Graph</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="app.js" defer></script>
</body>
</html>