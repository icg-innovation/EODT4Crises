<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EODT4Crises - Interactive Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="map"></div>
    <div id="loader">Processing...</div>

    <div class="title-overlay">EODT4Crises Road Identification</div>

    <div class="controls-container">
        <div class="layer-control">
            <label class="switch"><input type="checkbox" id="baseMapToggle" checked><span class="slider round"></span></label>
            <span class="toggle-label">Base Map</span>
        </div>
        <div class="layer-control">
            <label class="switch"><input type="checkbox" id="roadToggle" checked><span class="slider round"></span></label>
            <span class="toggle-label">OSM Roads</span>
        </div>


        <div class="road-filters section-divider">
            <div class="collapsible-header"><strong>OSM Road Types</strong><span class="arrow">â–¼</span></div>
            <div class="collapsible-content">
                <label><input type="checkbox" class="road-type-filter" value="motorway" checked> Motorway</label>
                <label><input type="checkbox" class="road-type-filter" value="motorway_link" checked> Motorway Link</label>
                <label><input type="checkbox" class="road-type-filter" value="trunk" checked> Trunk</label>
                <label><input type="checkbox" class="road-type-filter" value="trunk_link" checked> Trunk Link</label>
                <label><input type="checkbox" class="road-type-filter" value="primary" checked> Primary</label>
                <label><input type="checkbox" class="road-type-filter" value="secondary" checked> Secondary</label>
                <label><input type="checkbox" class="road-type-filter" value="tertiary" checked> Tertiary</label>
                <label><input type="checkbox" class="road-type-filter" value="residential" checked> Residential</label>
                <label><input type="checkbox" class="road-type-filter" value="unclassified" checked> Unclassified</label>
                <button id="updateRoadsBtn" class="action-button">Update Roads</button>
            </div>
        </div>
        
        <div class="analysis-workflow section-divider">
            <strong>Analysis Workflow:</strong>
            
            <div class="workflow-stage">
                <div class="satellite-selection">
                    <label for="satelliteSelect"><strong>Satellite:</strong></label>
                    <select id="satelliteSelect" style="width: 100%; padding: 5px; margin-top: 5px;">
                        <option value="sentinel_2" selected>Sentinel-2</option>
                        <option value="sentinel_1">Sentinel-1</option>
                    </select>
                </div>

                <div id="sentinel2Options" class="satellite-options" style="margin-top: 10px;">
                    <label for="cloudCoverSlider">Cloud Cover (%): <span id="cloudCoverValue">10</span>%</label>
                    <input type="range" id="cloudCoverSlider" min="0" max="100" value="10" style="width: 100%;">
                </div>

                <div id="sentinel1Options" class="satellite-options" style="display: none; margin-top: 10px;">
                    <label for="polarizationSelect">Polarization:</label>
                    <select id="polarizationSelect" style="width: 100%; padding: 5px; margin-top: 5px;">
                        <option value="VV" selected>VV</option>
                        <option value="VH">VH</option>
                    </select>
                </div>
                <div class="date-control-item" style="margin-top: 15px;">
                    <label for="startDate">Start Date:</label>
                    <input type="date" id="startDate" style="width: 100%;">
                </div>
                <div class="date-control-item">
                    <label for="midDate">Mid-Point Date:</label>
                    <input type="date" id="midDate" style="width: 100%;">
                </div>
                <div class="date-control-item">
                    <label for="endDate">End Date:</label>
                    <input type="date" id="endDate" style="width: 100%;">
                </div>
                <button id="generateImagesBtn" class="action-button" disabled>1. Generate Satellite Images</button>
                <button id="generateGTMaskBtn" class="action-button" disabled>2. Generate GT Mask</button>

                <div id="gtMaskControls" class="event-controls" style="display: none; border-color: #28a745;">
                    <h4 style="color: #28a745;">Ground Truth (OSM)</h4>
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="toggleGtMask" checked><span class="slider round"></span></label>
                        <span class="toggle-label">GT Mask</span>
                    </div>
                    <div class="layer-control">
                        <label class="toggle-label">Opacity:</label>
                        <input type="range" id="gtMaskOpacitySlider" min="0" max="1" step="0.05" value="0.7" class="opacity-slider">
                    </div>
                </div>

                <div id="preEventControls" class="event-controls" style="display: none;">
                    <h4>Pre-Event</h4>
                    <p id="preImageDateDisplay" class="image-date-display"></p>
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="togglePreSat" checked><span class="slider round"></span></label>
                        <span class="toggle-label">Satellite Image</span>
                    </div>
                    <div class="layer-control">
                        <label class="toggle-label">Opacity:</label>
                        <input type="range" id="preOpacitySlider" min="0" max="1" step="0.05" value="0.8" class="opacity-slider">
                    </div>
                    <button id="runPreDetectionBtn" class="action-button" disabled>3. Run Pre-Event Detection</button>
                    <div id="preDetectionControls" class="detection-controls" style="display: none;">
                        <div class="layer-control">
                            <label class="switch"><input type="checkbox" id="togglePrePredMask" checked><span class="slider round"></span></label>
                            <span class="toggle-label">Pred. Mask</span>
                        </div>
                        <div class="layer-control">
                            <label class="toggle-label">Opacity:</label>
                            <input type="range" id="prePredMaskOpacitySlider" min="0" max="1" step="0.05" value="0.7" class="opacity-slider">
                        </div>
                        <div class="layer-control">
                            <label class="switch"><input type="checkbox" id="togglePrePredGraph" checked><span class="slider round"></span></label>
                            <span class="toggle-label">Pred. Graph</span>
                        </div>
                    </div>
                </div>

                <div id="postEventControls" class="event-controls" style="display: none;">
                    <h4>Post-Event</h4>
                    <p id="postImageDateDisplay" class="image-date-display"></p>
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="togglePostSat" checked><span class="slider round"></span></label>
                        <span class="toggle-label">Satellite Image</span>
                    </div>
                    <div class="layer-control">
                        <label class="toggle-label">Opacity:</label>
                        <input type="range" id="postOpacitySlider" min="0" max="1" step="0.05" value="0.8" class="opacity-slider">
                    </div>
                    <button id="runPostDetectionBtn" class="action-button" disabled>4. Run Post-Event Detection</button>
                    <div id="postDetectionControls" class="detection-controls" style="display: none;">
                        <div class="layer-control">
                            <label class="switch"><input type="checkbox" id="togglePostPredMask" checked><span class="slider round"></span></label>
                            <span class="toggle-label">Pred. Mask</span>
                        </div>
                        <div class="layer-control">
                            <label class="toggle-label">Opacity:</label>
                            <input type="range" id="postPredMaskOpacitySlider" min="0" max="1" step="0.05" value="0.7" class="opacity-slider">
                        </div>
                        <div class="layer-control">
                            <label class="switch"><input type="checkbox" id="togglePostPredGraph" checked><span class="slider round"></span></label>
                            <span class="toggle-label">Pred. Graph</span>
                        </div>
                    </div>
                </div>
                
                <button id="compareRoadsBtn" class="action-button" disabled>5. Analyze Road Damage</button>
                <div id="damageAnalysisControls" class="event-controls" style="display: none; border-color: #dc3545;">
                    <h4 style="color: #dc3545;">Damage Analysis</h4>
                    <div class="layer-control">
                        <label class="switch"><input type="checkbox" id="toggleDamageLayer" checked><span class="slider round"></span></label>
                        <span class="toggle-label">Damaged Roads</span>
                    </div>
                    <div class="layer-control">
                        <label class="toggle-label">Opacity:</label>
                        <input type="range" id="damageOpacitySlider" min="0" max="1" step="0.05" value="0.9" class="opacity-slider">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="app.js" defer></script>
</body>
</html>